{% extends 'usuarios/baseU.html' %}
{% load humanize %}
{% load static %}
{% block title %}Dashboard Administrador{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'usuarios/css/panel-contacto-dashboard.css' %}">
{% endblock %}

{% block content %}
<body data-page="dashboard"></body>

<div class="contenedor-dashboard">
  <h1>Dashboard Administrador</h1>
  <form method="GET">
        <label>Filtrar por:</label>
        <select name="tiempo">
            <option value="">Todos</option>
            <option value="semana" {% if request.GET.tiempo == "semana" %}selected{% endif %}>Semana</option>
            <option value="mes" {% if request.GET.tiempo == "mes" %}selected{% endif %}>Mes</option>
            <option value="anio" {% if request.GET.tiempo == "anio" %}selected{% endif %}>Año</option>
        </select>

        <button type="submit">Aplicar</button>
    </form>
  <div class="cards">
    <div class="card" data-url="{% url 'usuarios:informe_ventas' %}">
      <h2>Ventas</h2>
      <p>${{ total_ventas|intcomma }}</p>
    </div>
    <div class="card" data-url="{% url 'productos:list_product' %}">
      <h2>Productos</h2>
      <p>{{ total_productos }}</p>
    </div>
    <div class="card" data-url="{% url 'usuarios:gstUsuarios' %}">
      <h2>Usuarios</h2>
      <p>{{ total_usuarios }}</p>
    </div>
    <div class="card" data-url="{% url 'usuarios:pedidos' %}">
      <h2>Pedidos</h2>
      <p>{{ total_pedidos }}</p>
    </div>
  </div>

  <div class="sections">
    <div class="section">
      <h3>Ventas por Mes</h3>
      <ul>
        {% for mes, valor in ventas_info %}
        <li>{{ mes }} — ${{ valor|intcomma }}</li>
        {% empty %}
        <li>No hay ventas registradas.</li>
        {% endfor %}
      </ul>
    </div>

    <div class="section">
      <h3>Estado de Pedidos</h3>
      <ul>
        {% for estado, cantidad in estado_info %}
        <li>{{ estado }} — {{ cantidad }}</li>
        {% empty %}
        <li>No hay pedidos registrados.</li>
        {% endfor %}
      </ul>
    </div>

    <div class="section">
      <h3>Productos Más Vendidos</h3>
      <ul>
        {% for prod in prod_info %}
        <li>{{ prod.nombProduc }} — {{ prod.total_vendidos }} vendidos</li>
        {% empty %}
        <li>No hay productos vendidos.</li>
        {% endfor %}
      </ul>
    </div>

    <div class="section">
      <h3>Usuarios con Más Compras</h3>
      <ul>
        {% for user in usuarios_info %}
        <li>{{ user.nombre }} — {{ user.pedidos_pagados }} pedidos</li>
        {% empty %}
        <li>No hay usuarios con compras registradas.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="section devoluciones-largas">
    <h3>Últimas 5 Devoluciones</h3>

    {% if ultimas_devoluciones %}
    <ul>
        {% for dev in ultimas_devoluciones %}
            <li>
                <strong>{{ dev.producto.nombProduc }}</strong><br>
                {{ dev.cantidad }} unidades — Motivo: {{ dev.motivo }}
            </li>
        {% endfor %}
    </ul>
    {% else %}
        <p>No hay devoluciones registradas.</p>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static '/usuarios/js/main.js' %}"></script>
{% endblock %}