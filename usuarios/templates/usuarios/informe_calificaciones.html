{% extends 'usuarios/baseU.html' %}
{% load static %}
{% block title %}Gestión de calificaciones{% endblock %}

{% load humanize %}
{% block styles %}
<link rel="stylesheet" href="{% static 'usuarios/css/lista_calificaciones.css' %}" />
{% endblock %}

{% block page_id %}calificaciones{% endblock %}

{% block content %}


<h1>Lista de calificaciones</h1>

<div class="container">

  <!-- Buscador -->
  <div class="search-container">
    <button class="btn-export" id="btnExportar">
      <i class="fa fa-file-excel"></i> Exportar a Excel
    </button>
    <input type="text" class="search-input" id="searchInput" placeholder="Buscar por usuario, comentario...">
    <div class="search-stats" id="searchStats"></div>
  </div>

  <div class="table-container">
    <table id="calificacionesTable">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Servicio</th>
          <th>Productos</th>
          <th>Comentario</th>
          <th>Fecha</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for c in calificaciones %}
        <tr
          data-search-text="{{ c.usuario.nombre|lower }} {{ c.puntuacion_servicio }} {{ c.puntuacion_productos }} {{ c.comentario|lower }} {{ c.fecha_creacion|date:'Y-m-d' }}">
          <td>{{ c.usuario.nombre }}</td>
          <td>{{ c.puntuacion_servicio }}</td>
          <td>{{ c.puntuacion_productos }}</td>
          <td>{{ c.comentario }}</td>
          <td>{{ c.fecha_creacion|date:"Y-m-d H:i" }}</td>
          <td>
            {% if not c.aprobado %}
            <a href="{% url 'usuarios:aprobar_comentario' c.id %}" class="btn-aceptar">Aprobar</a>
            <a href="{% url 'usuarios:rechazar_comentario' c.id %}" class="btn-rechazar">Rechazar</a>
            {% else %}
            <span class="estado-aprobado">✓ Aprobado</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="no-data">No hay calificaciones disponibles</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">
      {% if page_obj.has_previous %}
      <a href="?page=1">&laquo; Primera</a>
      <a href="?page={{ page_obj.previous_page_number }}">Anterior</a>
      {% endif %}

      <span class="current">
        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}">Siguiente</a>
      <a href="?page={{ page_obj.paginator.num_pages }}">Última &raquo;</a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'usuarios/js/gst_pedidos-ventas-calificaciones.js' %}"></script>
{% endblock %}